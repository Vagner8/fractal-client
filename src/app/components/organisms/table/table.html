@let tablesData = $tablesData();
@let columns = tablesData.columns();
@let dataSource = tablesData.dataSource();

@if (columns && columns.length > 0 && dataSource && dataSource.length > 0) {
  <table mat-table [dataSource]="dataSource">
    @for (column of columns; track column) {
      <ng-container [matColumnDef]="column">
        <th mat-header-cell *matHeaderCellDef>
          {{ column }}
        </th>
        <td mat-cell *matCellDef="let cursor; let index = index;">
          @let content = tablesData.tdContent({ index, cursor, column });
          @if ($editMode() && content.control) {
            <app-control-form [$control]="content.control" />
          } @else {
            {{ content.data }}
          }
        </td>
      </ng-container>
    }
    <tr mat-header-row *matHeaderRowDef="columns; sticky: true"></tr>
    <tr
      mat-row
      *matRowDef="let cursor; columns: columns"
      appTap
      (hold)="onRowHold(cursor)"
      (touch)="onRowTouch(cursor)"
      [class.selected-row]="$state().$$hasItemWithCursor(cursor)()"></tr>
  </table>
} @else {
  <p>No data to display</p>
}